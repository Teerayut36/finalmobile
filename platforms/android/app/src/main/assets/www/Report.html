<!DOCTYPE html>
<html>

<head>
    <head>
        <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
        <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
        <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
        <script src="ejs.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.5.0/firebase.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-firestore.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Baloo+Bhaijaan|Poor+Story" rel="stylesheet">
        <script src="https://www.gstatic.com/firebasejs/5.7.0/firebase.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Kanit" rel="stylesheet">
  <script>
    // Initialize Firebase
    var config = {
    apiKey: "AIzaSyCV-3dvAUevSse70YnxA0q53R_Ksd_MVTU",
    authDomain: "motorbike-39f30.firebaseapp.com",
    databaseURL: "https://motorbike-39f30.firebaseio.com",
    projectId: "motorbike-39f30",
    storageBucket: "motorbike-39f30.appspot.com",
    messagingSenderId: "1064933064524"
  };
    firebase.initializeApp(config);
    // Initialize Cloud Firestore through Firebase
    var db = firebase.firestore();
    // Disable deprecated features
    db.settings({
      timestampsInSnapshots: true
    });
  </script>
  <style>
   
    
    #appname {
      font-size: 20px;
      color: rgb(29, 29, 29)
    }
    #barup {
      background-color:#F2ED8C;
      font-family: 'Kanit', sans-serif;
    }
    #bardown {
      background-color: #F2ED8C;
      font-family: 'Kanit', sans-serif;
    }
    #textP {
      color: brown;
      font-size: 18px;
    }
    .toolbaricon {
      padding-left: 5px;
      padding-bottom: 5px;
      padding-right: 5px; 
      
    }
    * {
      font-family: 'ABeeZee', sans-serif;
      ;
    }
    .temback {
      background-color: rgb(26, 26, 26);
      background-repeat: rgb(29, 29, 29);
      background-size: cover;
    }
    .button--large--cta{
      color: rgb(29, 29, 29);
      font-family: 'Kanit', sans-serif;
    }
    .AA{
      color: rgb(29, 29, 29);
      font-family: 'Kanit', sans-serif;
      background-color:#F2ED8C;
    }
  </style>
</head>


<body>
  <ons-navigator swipeable id="myNavigator">
    <ons-page>
      <ons-toolbar id="barup">
        
        <div class="center" id="appname" style="position:center;">Report</div>
        <div class="right">
          <ons-icon class="toolbaricon" size="30px" icon="fa-sign-out-alt" onclick="window.location.href='home1.html'" style="position: relative;display: inline-block; margin-right:6%;">
          </ons-icon>
          </a>
        </div>
      </ons-toolbar>

      <ons-tabbar class ="AA" swipeable position="auto" id="tabslide">
        <ons-tab  class ="AA"id="bardown" page="tab1.html" label="ขาเข้า" icon="shipping-fast, material:md-home" active>
        </ons-tab>
        <ons-tab class ="AA" id="bardown" page="tab2.html" label="ขาออก" icon="fa-shopping-basket" badge="" active-icon="fa-shopping-basket">
        </ons-tab>
        <ons-tab class ="AA" page="tab3.html" label="ทำผิด" icon="fa-cart-plus" active-icon="fa-cart-plus">
        </ons-tab>
      </ons-tabbar>
    </ons-page>
  </ons-navigator>

  <template id="tab1.html">
      <ons-page>
         
    
          
          <div id="datacar"></div>
          <script id="product_template" type="text/template">
            <ons-row>
              <% datacar.forEach(function(datacar){
                var datacar = datacar.data();
                %>
      <ons-list-header>เข้า</ons-list-header>
      <ons-list-item>
              
            
          <div class="center">
            <span class="list-item__title">ป้ายทะเบียน : <%= datacar.Licenseplate %></span>
            <span class="list-item__subtitle">รหัสนักศึกษา :<%= datacar.sid %></span>
           
            <span class="list-item__subtitle">เวลา : <%= datacar.date %></span>
           
          </div>
        
  </ons-list-item>
      
      
      <%});%> 
       </ons-row>
       
      
      </Script>
          </div>
    
        </ons-page>
  </template>

  <template id="tab2.html">
      <ons-page>
         
    
         
          <div id="datacar1"></div>
          <script id="product_template1" type="text/template">
            <ons-row>
              <% datacar.forEach(function(datacar){
                var datacar = datacar.data();
                %>
      <ons-list-header>ออก</ons-list-header>
          <ons-list-item>
              
            
                  <div class="center">
                    <span class="list-item__title">ป้ายทะเบียน : <%= datacar.Licenseplate %></span>
                    <span class="list-item__subtitle">รหัสนักศึกษา :<%= datacar.sid %></span>
                   
                    <span class="list-item__subtitle">เวลา : <%= datacar.date %></span>
                   
                  </div>
                
          </ons-list-item>
      
      
      <%});%> 
       </ons-row>
       
      
      </Script>
          </div>
    
        </ons-page>
  </template>


  <template id="alert-dialog.html">
    <ons-alert-dialog id="my-alert-dialog" modifier="rowfooter">
      <div class="alert-dialog-title">Alert</div>
      <div class="alert-dialog-content">
        This dialog was created from a template
      </div>
      <div class="alert-dialog-footer">
        <ons-alert-dialog-button onclick="hideAlertDialog()">Cancel</ons-alert-dialog-button>
        <ons-alert-dialog-button onclick="hideAlertDialog()">OK</ons-alert-dialog-button>
      </div>
    </ons-alert-dialog>
  </template>

  <template id="tab3.html">
    <ons-page id="Tab3" class="temback">
      
      <hr>
      
      <script id="allP_template" type="text/template">
       <ons-row>
  
      
      <ons-col width="50%" style="border:solid 3px white; border-radius: 10px; background-color: lightgrey;" onclick="getproDetail('<%= item.title %>');"> 
       
      </ons-col>
      
      
    </script>

      </ons-row>
      

    </ons-page>
  </template>

  <template id="tab3.html">
      <ons-page>
         
    
          
          <div id="datacar2"></div>
          <script id="product_template2" type="text/template">
            <ons-row>
              <% datacar.forEach(function(datacar){
                var datacar = datacar.data();
                %>
      <ons-list-header>ทำผิดกฎ</ons-list-header>
          <ons-list-item>
            
            <div class="center">
              <span class="list-item__title">ป้ายทะเบียน : <%= datacar.Licenseplate %></span>
              <span class="list-item__subtitle">รหัสนักศึกษา :<%= datacar.sid %></span>
              <span class="list-item__subtitle">หมายเหตุ:<%= datacar.message %></span>
              <span class="list-item__subtitle">เวลา : <%= datacar.date %></span>
             
            </div>
          </ons-list-item>
      
      
      <%});%> 
       </ons-row>
       
      
      </Script>
          </div>
    
        </ons-page>
  </template>

  <ons-modal direction="up">
    <div style="text-align: center">
      <p>
        <ons-icon icon="md-spinner" size="28px" spin></ons-icon> Loading...
      </p>
    </div>
  </ons-modal>

</body>

<script>
  // run first template 
  getHomeData();
  // run array from database
  
  // function select tabbar
  document.addEventListener('prechange', function (event) {
    if (event.index == 0) {
  
    
      getHomeData();
      console.log(event.index);
    } else if (event.index == 1) {
     
      getAllproduct()
      console.log(event.index);
    } else if (event.index == 2) {
      getAllrule()
      console.log(event.index);
    }
  });
    function getHomeData() {
      db.collection("come").get()
          .then(function (querySnapshot) {
            // doc.data() is never undefined for query doc snapshots
            var product_template = $('#product_template').html();
            console.log(querySnapshot.docs);
            var html = ejs.render(product_template, {
              datacar: querySnapshot.docs
            });
            $('#datacar').html(html);
          })
          .catch(function (error) {
            console.log("Error getting documents: ", error);
          });
  }

  function getAllproduct() {
    db.collection("out").get()
          .then(function (querySnapshot) {
            // doc.data() is never undefined for query doc snapshots
            var product_template1 = $('#product_template1').html();
            console.log(querySnapshot.docs);
            var html = ejs.render(product_template1, {
              datacar: querySnapshot.docs
            });
            $('#datacar1').html(html);
          })
          .catch(function (error) {
            console.log("Error getting documents: ", error);
          });
  }
  function getAllrule() {
    db.collection("rule").get()
          .then(function (querySnapshot) {
            // doc.data() is never undefined for query doc snapshots
            var product_template2 = $('#product_template2').html();
            console.log(querySnapshot.docs);
            var html = ejs.render(product_template2, {
              datacar: querySnapshot.docs
            });
            $('#datacar2').html(html);
          })
          .catch(function (error) {
            console.log("Error getting documents: ", error);
          });
  }

  
</script>

</html>